---

- name: k8s firewall
  hosts: master
  vars_files:
    - "group_vars/firewall_k8s.yaml"
  gather_facts: no
  roles:
    - firewall

- name: configurar kudeadm
  hosts: master
  gather_facts: no
  tasks:
    - name: configurar kudeadm
      command: kubeadm config images pull
      become: true

- name: acceso worker firewall
  hosts: master
  vars_files:
    - "group_vars/firewall_k8s_worker.yaml"
  gather_facts: no
  roles:
    - firewall3

- name: instalar plugin CNI
  hosts: master
  gather_facts: no
  tasks:
    - name: instalar plugin CNI
      command: kubeadm init --pod-network-cidr 192.169.0.0/16
      register: output_kubeadm
      become: true

- name: guardar salida
  hosts: master
  gather_facts: no
  tasks:
    - name: guardar output_kubeadm /tmp/output_kubeadm.log
      copy:
        src: "{{ output_kubeadm.stdout }}"
        dest:  /tmp/output_kubeadm.log
        owner: root
        group: root
        mode: 0644
      become: true